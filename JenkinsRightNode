pipeline {
    parameters {
        string(defaultValue: '', description: 'Write java to execute only java check', name: 'TAG_JAVA')
        string(defaultValue: '', description: 'Write java to execute only java check', name: 'TAG_COBOL')
        string(defaultValue: '', description: 'Write java to execute only java check', name: 'TAG_CUCUMBER)')
        string(defaultValue: '', description: 'Write java to execute only java check', name: 'TAG_SONAR')
    }

    agent { label 'Right_node'}
     stages {
         stage('Check Environment') {
             steps {
                 ansiblePlaybook become: true, installation: 'Ansible', inventory: 'l', playbook: 'ansible/check_playbook.yml'
             }
         }
         stage('Unit Testing') {
             steps {
                 echo 'Compile unit testing framework'
                 echo 'Unit test'
                 sh './compile ZUTZCPC'
                 echo 'Run test suite calculator'
                 sh './run-ut CALCULATOR2C CALCULATOR2 CALCULATOR2T'
             }
         }
         stage('SonarCloud Analysis') {            
             environment {
                 scannerHome = tool 'SonarCubeScanner'
             }            
             steps {
                 withSonarQubeEnv('sonar') {
                     sh "${scannerHome}/bin/sonar-scanner"
                 }               
             }
         }
        stage('Functional Testing Cucumber') {
            steps {
                sh 'cd src/main/cobol; cobc -free -x -o calculator2-exe CALCULATOR2.CBL; ls -al; cp calculator2-exe /tmp; ls /tmp;'
                checkout changelog: false, poll: false, scm: [$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[url: 'https://github.com/diana-estrada/hellocucumber.git']]]
                echo 'Buid the calculator binary'
                sh 'chmod 777 /tmp/calculator2-exe; cp /tmp/calculator2-exe .; ls -al; pwd; mvn clean test; pwd'
            }
        }
        
    }
    
}
